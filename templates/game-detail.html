<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{GAME_DESCRIPTION}}">
    <meta name="keywords" content="{{GAME_TAGS}}, Atlas Games">
    <meta name="author" content="Atlas Games">

    <!-- Open Graph -->
    <meta property="og:title" content="{{GAME_TITLE}} - Atlas Games">
    <meta property="og:description" content="{{GAME_DESCRIPTION}}">
    <meta property="og:image" content="{{GAME_THUMBNAIL}}">
    <meta property="og:url" content="{{GAME_URL}}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Atlas Games">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{GAME_TITLE}} - Atlas Games">
    <meta name="twitter:description" content="{{GAME_DESCRIPTION}}">
    <meta name="twitter:image" content="{{GAME_THUMBNAIL}}">

    <!-- JSON-LD Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "VideoGame",
        "name": "{{GAME_TITLE}}",
        "description": "{{GAME_LONG_DESCRIPTION}}",
        "image": "{{GAME_THUMBNAIL}}",
        "url": "{{GAME_URL}}",
        "publisher": {
            "@type": "Organization",
            "name": "Atlas Games"
        },
        "genre": "{{GAME_GENRE}}",
        "playMode": "{{GAME_PLATFORMS}}",
        "datePublished": "{{GAME_RELEASE_DATE}}"
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/games-detail.css">

    <title>{{GAME_TITLE}} - Atlas Games</title>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div id="header"></div>
    <div id="nav"></div>

    <main id="main-content">
        <div class="container">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="Breadcrumb navigation">
                <ol>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../games.html">Games</a></li>
                    <li aria-current="page">{{GAME_TITLE}}</li>
                </ol>
            </nav>

            <!-- Game Header -->
            <header class="game-header section">
                <div class="game-hero">
                    <div class="game-info">
                        <h1>{{GAME_TITLE}}</h1>
                        <div class="game-meta">
                            <span class="release-date">Released: {{GAME_RELEASE_DATE_FORMATTED}}</span>
                            <span class="genre">Genre: {{GAME_GENRE}}</span>
                            <span class="status status-{{GAME_STATUS_CLASS}}">{{GAME_STATUS}}</span>
                        </div>
                        <div class="game-platforms">
                            {{GAME_PLATFORM_BADGES}}
                        </div>
                        <p class="game-description">{{GAME_DESCRIPTION}}</p>
                        <div class="game-actions">
                            <a href="{{GAME_ITCH_URL}}" class="btn btn-primary" target="_blank" rel="noopener">Play Now</a>
                            <button class="btn btn-secondary" id="share-btn">Share Game</button>
                        </div>
                    </div>
                    <div class="game-thumbnail">
                        <img src="{{GAME_THUMBNAIL}}" alt="{{GAME_TITLE}}" loading="eager">
                    </div>
                </div>
            </header>

            <!-- Game Content -->
            <div class="game-content">
                <!-- Screenshots Gallery -->
                <section class="screenshots-section section">
                    <h2>Screenshots</h2>
                    <div class="screenshots-grid" id="screenshots-gallery">
                        {{GAME_SCREENSHOTS}}
                    </div>
                </section>

                <!-- Trailer -->
                <section class="trailer-section section">
                    <h2>Game Trailer</h2>
                    <div class="trailer-container">
                        <iframe
                            src="{{GAME_TRAILER_EMBED}}"
                            title="{{GAME_TITLE}} Trailer"
                            frameborder="0"
                            allowfullscreen
                            loading="lazy">
                        </iframe>
                    </div>
                </section>

                <!-- Game Details -->
                <section class="game-details section">
                    <h2>About This Game</h2>
                    <div class="game-description-full">
                        {{GAME_LONG_DESCRIPTION}}
                    </div>

                    <div class="game-specs">
                        <div class="spec-item">
                            <h3>Genre</h3>
                            <p>{{GAME_GENRE}}</p>
                        </div>
                        <div class="spec-item">
                            <h3>Platforms</h3>
                            <div class="platforms-list">{{GAME_PLATFORM_LIST}}</div>
                        </div>
                        <div class="spec-item">
                            <h3>Release Date</h3>
                            <p>{{GAME_RELEASE_DATE_FORMATTED}}</p>
                        </div>
                        <div class="spec-item">
                            <h3>Status</h3>
                            <p>{{GAME_STATUS}}</p>
                        </div>
                        <div class="spec-item">
                            <h3>Tags</h3>
                            <div class="tags-list">{{GAME_TAGS_LIST}}</div>
                        </div>
                    </div>
                </section>

                <!-- Related Content -->
                <aside class="related-content section">
                    <div class="related-grid">
                        <!-- Related Blogs -->
                        <div class="related-blogs">
                            <h3>Related Blog Posts</h3>
                            <div id="related-blogs-container">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Patch Notes -->
                        <div class="patch-notes">
                            <h3>Latest Updates</h3>
                            <div id="patch-notes-container">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <div id="footer"></div>

    <!-- Lightbox Modal -->
    <div id="lightbox-modal" class="lightbox-modal" role="dialog" aria-labelledby="lightbox-title" aria-hidden="true">
        <div class="lightbox-content">
            <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
            <img id="lightbox-image" src="" alt="" loading="lazy">
            <div class="lightbox-caption" id="lightbox-title"></div>
            <div class="lightbox-nav">
                <button class="lightbox-prev" aria-label="Previous image">&#8249;</button>
                <button class="lightbox-next" aria-label="Next image">&#8250;</button>
            </div>
        </div>
    </div>

    <script src="../../assets/js/includes.js" defer></script>
    <script src="../../assets/js/utils.js" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initializeLightbox();
            initializeSharing();
            loadRelatedContent();
        });

        function initializeLightbox() {
            const modal = document.getElementById('lightbox-modal');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxTitle = document.getElementById('lightbox-title');
            const closeBtn = document.querySelector('.lightbox-close');
            const prevBtn = document.querySelector('.lightbox-prev');
            const nextBtn = document.querySelector('.lightbox-next');

            let currentImageIndex = 0;
            const screenshots = Array.from(document.querySelectorAll('.screenshot-thumb'));

            screenshots.forEach((thumb, index) => {
                thumb.addEventListener('click', () => {
                    currentImageIndex = index;
                    showLightbox(thumb.src, thumb.alt);
                });
            });

            function showLightbox(src, alt) {
                lightboxImage.src = src;
                lightboxImage.alt = alt;
                lightboxTitle.textContent = alt;
                modal.style.display = 'flex';
                modal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
            }

            function hideLightbox() {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
            }

            closeBtn.addEventListener('click', hideLightbox);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) hideLightbox();
            });

            prevBtn.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex - 1 + screenshots.length) % screenshots.length;
                const prevThumb = screenshots[currentImageIndex];
                showLightbox(prevThumb.src, prevThumb.alt);
            });

            nextBtn.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex + 1) % screenshots.length;
                const nextThumb = screenshots[currentImageIndex];
                showLightbox(nextThumb.src, nextThumb.alt);
            });

            document.addEventListener('keydown', (e) => {
                if (modal.style.display === 'flex') {
                    if (e.key === 'Escape') hideLightbox();
                    if (e.key === 'ArrowLeft') prevBtn.click();
                    if (e.key === 'ArrowRight') nextBtn.click();
                }
            });
        }

        function initializeSharing() {
            const shareBtn = document.getElementById('share-btn');

            shareBtn.addEventListener('click', async () => {
                const shareData = {
                    title: '{{GAME_TITLE}} - Atlas Games',
                    text: '{{GAME_DESCRIPTION}}',
                    url: window.location.href
                };

                if (navigator.share) {
                    try {
                        await navigator.share(shareData);
                    } catch (err) {
                        console.log('Error sharing:', err);
                    }
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(window.location.href);
                    showMessage('Link copied to clipboard!');
                }
            });
        }

        async function loadRelatedContent() {
            // Load related blogs
            try {
                const blogsResponse = await fetch('../../data/blogs.json');
                const blogs = await blogsResponse.json();
                const relatedBlogs = blogs.filter(blog =>
                    blog.relatedGame === '{{GAME_SLUG}}' ||
                    (blog.tags && blog.tags.some(tag => '{{GAME_TAGS}}'.includes(tag)))
                ).slice(0, 3);

                const blogsContainer = document.getElementById('related-blogs-container');
                if (relatedBlogs.length > 0) {
                    blogsContainer.innerHTML = relatedBlogs.map(blog => `
                        <article class="related-item">
                            <h4><a href="../../${blog.detailPath}">${blog.title}</a></h4>
                            <p>${blog.excerpt.substring(0, 100)}...</p>
                        </article>
                    `).join('');
                } else {
                    blogsContainer.innerHTML = '<p>No related blog posts found.</p>';
                }
            } catch (error) {
                console.error('Error loading related blogs:', error);
            }

            // Load patch notes
            try {
                const patchNotesResponse = await fetch('../../data/patch-notes.json');
                const patchNotes = await patchNotesResponse.json();
                const gamePatchNotes = patchNotes.filter(patch =>
                    patch.relatedGame === '{{GAME_SLUG}}'
                ).slice(0, 3);

                const patchContainer = document.getElementById('patch-notes-container');
                if (gamePatchNotes.length > 0) {
                    patchContainer.innerHTML = gamePatchNotes.map(patch => `
                        <article class="related-item">
                            <h4><a href="../../${patch.detailPath}">${patch.title}</a></h4>
                            <p>Version ${patch.number} - ${Utils.formatDate(patch.date)}</p>
                        </article>
                    `).join('');
                } else {
                    patchContainer.innerHTML = '<p>No patch notes available.</p>';
                }
            } catch (error) {
                console.error('Error loading patch notes:', error);
            }
        }

        function showMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'toast-message';
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>

